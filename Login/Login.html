<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Tajmir Group</title>
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Part 1: Brand Panel -->
        <div class="brand-panel" id="brand-panel">
    <div class="brand-content">
        <img src="logo.png" alt="Tajmir Group Logo" class="brand-logo">
        <h1 class="brand-title">TAJMIR GROUP</h1>
        <p class="brand-subtitle">Secure Access Portal</p>
    </div>
</div>
        <!-- Part 2: Login Panel -->
        <div class="login-panel" id="login-panel">
            <form id="login-form" class="login-form">
                <div class="form-header">
                    <i class="fa-solid fa-users form-icon-main"></i>
                </div>
                
                <p class="error-message" id="error-message">Invalid username or password.</p>

                <div class="input-group">
                    <i class="fa-solid fa-user input-icon"></i>
                    <input type="text" id="username" placeholder="Username" required>
                </div>
                <div class="input-group">
                    <i class="fa-solid fa-lock input-icon"></i>
                    <input type="password" id="password" placeholder="Password" required>
                </div>
                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" name="remember"> Remember me
                    </label>
                    <a href="#" class="forgot-password">
                        <i class="fa-solid fa-envelope"></i> Forgot Password
                    </a>
                </div>
                <button type="submit" class="login-button">LOGIN</button>
            </form>
        </div>

        <!-- Part 3: Admin Dashboard (Hidden by default) -->
        <div id="admin-dashboard">
             <!-- Content will be generated by JavaScript -->
        </div>

    </div>

<script>
    // --- UTILITY FUNCTIONS ---

    /**
     * Parses the text from user_access.txt into a usable JavaScript object.
     * This simple parser handles the key = "value" format.
     */
    function parseUserFile(text) {
        const users = {};
        let currentUser = null;

        const lines = text.split('\n');
        for (const line of lines) {
            const trimmedLine = line.trim();
            if (trimmedLine.startsWith(';') || trimmedLine === '') {
                continue; // Skip comments and empty lines
            }
            if (trimmedLine.startsWith('[') && trimmedLine.endsWith(']')) {
                currentUser = trimmedLine.substring(1, trimmedLine.length - 1);
                users[currentUser] = {};
            } else if (currentUser && trimmedLine.includes('=')) {
                const parts = trimmedLine.split('=');
                const key = parts[0].trim();
                const value = parts.slice(1).join('=').trim().replace(/"/g, ''); // Remove quotes
                users[currentUser][key] = value;
            }
        }
        return users;
    }


    /**
     * Takes the parsed user data and builds the admin dashboard HTML table.
     */
    function buildAdminDashboard(users) {
        const dashboard = document.getElementById('admin-dashboard');
        
        let tableHtml = `
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h1>Admin Dashboard</h1>
                    <a id="logout-button" class="logout-btn">Logout</a>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Access Link / Destination</th>
                        </tr>
                    </thead>
                    <tbody>`;
        
        for (const key in users) {
            const user = users[key];
            if (user.role !== 'admin') { // Don't show the admin in the list
                tableHtml += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.role}</td>
                        <td><a href="${user.access_link}" target="_blank">${user.access_link}</a></td>
                    </tr>`;
            }
        }

        tableHtml += `</tbody></table></div>`;
        dashboard.innerHTML = tableHtml;

        // Add event listener for the new logout button
        document.getElementById('logout-button').addEventListener('click', () => {
            window.location.reload(); // Simple logout by reloading the page
        });
    }


    // --- MAIN LOGIN LOGIC ---
    document.getElementById('login-form').addEventListener('submit', async function(event) {
        event.preventDefault(); // Stop the form from submitting traditionally

        const usernameInput = document.getElementById('username').value;
        const passwordInput = document.getElementById('password').value;
        const errorMessage = document.getElementById('error-message');
        
        try {
            // Fetch the user data file from the server
            const response = await fetch('user_access.txt');
            if (!response.ok) {
                throw new Error('Could not load user data file.');
            }
            const fileContent = await response.text();
            const users = parseUserFile(fileContent);

            let authenticatedUser = null;
            // Find the user that matches the credentials
            for (const key in users) {
                const user = users[key];
                if (user.username === usernameInput && user.password === passwordInput) {
                    authenticatedUser = user;
                    break;
                }
            }

            if (authenticatedUser) {
                // SUCCESS! Now check the role.
                errorMessage.style.display = 'none';

                if (authenticatedUser.role === 'admin') {
                    // Show the Admin Dashboard
                    buildAdminDashboard(users);
                    document.getElementById('brand-panel').classList.add('hidden');
                    document.getElementById('login-panel').classList.add('hidden');
                    document.getElementById('admin-dashboard').style.display = 'flex';
                } else {
                    // Redirect a normal user
                    alert(`Login successful! Redirecting to your destination...`);
                    window.location.href = authenticatedUser.access_link;
                }
            } else {
                // FAIL! Show error message.
                errorMessage.style.display = 'block';
            }
        } catch (error) {
            console.error("Login Error:", error);
            errorMessage.textContent = 'A system error occurred. Please try again later.';
            errorMessage.style.display = 'block';
        }
    });

</script>

</body>
</html>