<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tajmir Group</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>

    <header class="site-header">
        <div class="header-top-bar">
            <!-- Contact info from before -->
            <div class="contact-info">
                <a href="tel:+8801755880400">
                    <i class="bi bi-telephone-fill"></i> +8801755880400
                </a>
                <a href="mailto:tajmirgroup@gmail.com">
                    <i class="bi bi-envelope-fill"></i> tajmirgroup@
                </a>
            </div>
            <!-- Social icons from before -->
            <div class="social-icons">
                <a href="#" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
                <a href="#" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
            </div>
        </div>
        <nav class="main-nav">
            <div class="logo">
                <a href="#">TAJMIR GROUP</a>
            </div>
            <button class="menu-toggle" onclick="toggleMenu()">
                <i class="bi bi-list"></i>
            </button>
            <ul class="nav-links">
                <button class="close-menu" onclick="toggleMenu()">
                    <i class="bi bi-x-lg"></i>
                </button>
                <li class="dropdown"><a href="#">About <span class="arrow-down"></span></a><ul class="dropdown-menu"><li><a href="#">Our History</a></li><li><a href="#">Mission & Vision</a></li></ul></li>
                <li class="dropdown"><a href="#">Enterprise <span class="arrow-down"></span></a><ul class="dropdown-menu"><li><a href="#">Export-Import</a></li><li class="dropdown-submenu"><a href="#">Distribution <span class="arrow-right"></span></a><ul class="submenu-menu"><li class="dropdown-submenu"><a href="#">Oil <span class="arrow-right"></span></a><ul class="submenu-menu"><li><a href="#">Shapla Oil Agency</a></li><li><a href="#">ShaporirDip Oil Agency</a></li></ul></li><li class="dropdown-submenu"><a href="#">Gas <span class="arrow-right"></span></a><ul class="submenu-menu"><li><a href="https://www.facebook.com/mirtradingLPG?rdid=S2YBoYGa1WkMQ7SG&share_url=https%3A%2F%2Fwww.facebook.com%2Fshare%2F14Gz2PpeVXT%2F#">Mir Treading</a></li></ul></li></ul></li><li><a href="#">Business</a></li><li><a href="#">C&F Business</a></li><li><a href="#">Trading</a></li><li><a href="#">Supplies</a></li><li><a href="#">Logistics</a></li><li><a href="#">Manufacture</a></li><li class="dropdown-submenu"><a href="#">Restaurant <span class="arrow-right"></span></a><ul class="submenu-menu"><li><a href="https://www.facebook.com/share/16HQfzKCMu/">Night Blust</a></li><li><a href="#">Empty Submenu Item</a></li></ul></li></ul></li>
                <li class="dropdown"><a href="#">Messages <span class="arrow-down"></span></a><ul class="dropdown-menu"><li class="dropdown-submenu"><a href="#">Message Type 1 <span class="arrow-right"></span></a><ul class="submenu-menu"><li><a href="#">Sub Item A</a></li><li><a href="#">Sub Item B</a></li></ul></li><li><a href="#">Message Type 2</a></li></ul></li>
                <li class="dropdown"><a href="#">Media <span class="arrow-down"></span></a><ul class="dropdown-menu"><li class="dropdown-submenu"><a href="#">Photo Gallery <span class="arrow-right"></span></a><ul class="submenu-menu"><li><a href="#">Event 2023</a></li><li><a href="#">Event 2024</a></li></ul></li><li class="dropdown-submenu"><a href="#">Video Gallery <span class="arrow-right"></span></a><ul class="submenu-menu"><li><a href="#">Corporate</a></li><li><a href="#">Commercial</a></li></ul></li></ul></li>
                <li class="dropdown"><a href="#">Contact <span class="arrow-down"></span></a><ul class="dropdown-menu"><li><a href="#">Head Office</a></li><li><a href="#">Branch Office</a></li></ul></li>
                
                <!-- MODIFIED: This now opens the popup -->
                <li>
                    <a href="#" class="login-icon" id="open-login-popup" title="Open Login">
                        <i class="bi bi-person-circle"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <main class="hero-section">
        <div class="hero-content">
            <form action="https://www.google.com/search" method="get" target="_blank" class="search-form">
                <div class="search-bar">
                    <i class="bi bi-search"></i>
                    <input type="text" name="q" placeholder="Search anything with Google..." required>
                </div>
                <button type="submit">Search</button>
            </form>
        </div>
    </main>

    <!-- NEW: Fullscreen Login Popup -->
    <div id="login-popup-overlay">
        <button class="popup-close-btn" title="Close">Ã—</button>
        <div class="login-container">
            <!-- Part 1: Brand Panel -->
            <div class="brand-panel" id="brand-panel">
                <div class="brand-content">
                    <img src="logo.png" alt="Tajmir Group Logo" class="brand-logo">
                    <h1 class="brand-title">TAJMIR GROUP</h1>
                    <p class="brand-subtitle">Secure Access Portal</p>
                </div>
            </div>
            <!-- Part 2: Login Panel -->
            <div class="login-panel" id="login-panel">
                <form id="login-form" class="login-form">
                    <div class="form-header">
                        <i class="fa-solid fa-users form-icon-main"></i>
                    </div>
                    
                    <p class="error-message" id="error-message">Invalid username or password.</p>
    
                    <div class="input-group">
                        <i class="fa-solid fa-user input-icon"></i>
                        <input type="text" id="username" placeholder="Username" required>
                    </div>
                    <div class="input-group">
                        <i class="fa-solid fa-lock input-icon"></i>
                        <input type="password" id="password" placeholder="Password" required>
                    </div>
                    <div class="form-options">
                        <label class="remember-me">
                            <input type="checkbox" name="remember"> Remember me
                        </label>
                        <a href="#" class="forgot-password">
                            <i class="fa-solid fa-envelope"></i> Forgot Password
                        </a>
                    </div>
                    <button type="submit" class="login-button">LOGIN</button>
                </form>
            </div>
    
            <!-- Part 3: Admin Dashboard (Hidden by default) -->
            <div id="admin-dashboard">
                 <!-- Content will be generated by JavaScript -->
            </div>
        </div>
    </div>


    <!-- UPDATED SCRIPT BLOCK -->
    <script>
        // --- Navigation Menu Logic ---
        function toggleMenu() {
            document.querySelector('.nav-links').classList.toggle('active');
        }
        document.addEventListener('click', (e) => {
            const navLinks = document.querySelector('.nav-links');
            if (navLinks.classList.contains('active') && !navLinks.contains(e.target) && !e.target.closest('.menu-toggle')) {
                navLinks.classList.remove('active');
            }
        });
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.dropdown > a, .dropdown-submenu > a').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        e.preventDefault();
                        const parentLi = this.parentElement;
                        const submenu = parentLi.querySelector('.dropdown-menu, .submenu-menu');
                        if (!submenu) return;
                        const isAlreadyOpen = submenu.classList.contains('submenu-active');
                        parentLi.parentElement.querySelectorAll('.submenu-active').forEach(openMenu => {
                            openMenu.classList.remove('submenu-active');
                            openMenu.parentElement.classList.remove('menu-item-open');
                        });
                        if (!isAlreadyOpen) {
                            submenu.classList.add('submenu-active');
                            parentLi.classList.add('menu-item-open');
                        }
                    }
                });
            });
        });

        // --- NEW: Login Popup Logic ---
        const openLoginButton = document.getElementById('open-login-popup');
        const loginOverlay = document.getElementById('login-popup-overlay');
        const closeLoginButton = document.querySelector('.popup-close-btn');

        openLoginButton.addEventListener('click', (e) => {
            e.preventDefault();
            loginOverlay.classList.add('active');
        });
        closeLoginButton.addEventListener('click', () => {
            loginOverlay.classList.remove('active');
        });
        loginOverlay.addEventListener('click', (e) => {
            if (e.target === loginOverlay) { // Close if clicking on the background overlay
                loginOverlay.classList.remove('active');
            }
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && loginOverlay.classList.contains('active')) {
                loginOverlay.classList.remove('active');
            }
        });

        // --- Core Login Functionality ---
        function parseUserFile(text) {
            const users = {}; let currentUser = null;
            text.split('\n').forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.startsWith(';') || trimmedLine === '') return;
                if (trimmedLine.startsWith('[') && trimmedLine.endsWith(']')) {
                    currentUser = trimmedLine.substring(1, trimmedLine.length - 1);
                    users[currentUser] = {};
                } else if (currentUser && trimmedLine.includes('=')) {
                    const [key, ...valueParts] = trimmedLine.split('=');
                    const value = valueParts.join('=').trim().replace(/"/g, '');
                    users[currentUser][key.trim()] = value;
                }
            });
            return users;
        }

        function buildAdminDashboard(users) {
            const dashboard = document.getElementById('admin-dashboard');
            let tableHtml = `<div class="dashboard-container"><div class="dashboard-header"><h1>Admin Dashboard</h1><a id="logout-button" class="logout-btn">Logout</a></div><table><thead><tr><th>Username</th><th>Role</th><th>Access Link / Destination</th></tr></thead><tbody>`;
            for (const key in users) { if (users[key].role !== 'admin') tableHtml += `<tr><td>${users[key].username}</td><td>${users[key].role}</td><td><a href="${users[key].access_link}" target="_blank">${users[key].access_link}</a></td></tr>`; }
            tableHtml += `</tbody></table></div>`;
            dashboard.innerHTML = tableHtml;
            document.getElementById('logout-button').addEventListener('click', () => { window.location.reload(); });
        }

        document.getElementById('login-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const usernameInput = document.getElementById('username').value;
            const passwordInput = document.getElementById('password').value;
            const errorMessage = document.getElementById('error-message');
            try {
                const response = await fetch('user_access.txt');
                if (!response.ok) throw new Error('Could not load user data file.');
                const users = parseUserFile(await response.text());
                let authenticatedUser = Object.values(users).find(u => u.username === usernameInput && u.password === passwordInput);
                if (authenticatedUser) {
                    errorMessage.style.display = 'none';
                    if (authenticatedUser.role === 'admin') {
                        buildAdminDashboard(users);
                        document.getElementById('brand-panel').classList.add('hidden');
                        document.getElementById('login-panel').classList.add('hidden');
                        document.getElementById('admin-dashboard').style.display = 'flex';
                    } else {
                        alert(`Login successful! Redirecting...`);
                        window.location.href = authenticatedUser.access_link;
                    }
                } else {
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                console.error("Login Error:", error);
                errorMessage.textContent = 'A system error occurred.';
                errorMessage.style.display = 'block';
            }
        });
    </script>
</body>
</html>